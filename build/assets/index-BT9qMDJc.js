import{u as v,a as d,g as D,b as N,r as l,f as F,j as n,D as A,d as H,B,e as E,A as O,h as T,o as y}from"./index-DMNo7Djr.js";import{f as G,F as R}from"./flowFilter-p0DC2f62.js";import{g as q,a as z}from"./groupsList-CguXKXwi.js";import"./textArea-BjD0uZnN.js";import{P as J}from"./pagination-D7QdfpUG.js";import{g as M}from"./searchSelector-CJfw-E7m.js";import"./oftenUsedSelector-DDKSaiMY.js";import"./teachers-CY3TjWvG.js";const U="_flow_14ck2_1",V="_flowListHeader_14ck2_4",$="_table__footer_14ck2_24",K="_active_14ck2_31",Q="_table__btn_14ck2_35",o={flow:U,flowListHeader:V,table__footer:$,active:K,table__btn:Q},ls=()=>{const{request:C}=E(),i=v(),u=d(D)?.id,x=N();l.useEffect(()=>{u&&(i(G()),i(F({userBranchId:u})))},[u]);const g=d(q),L=d(z),p=d(M);let b=l.useMemo(()=>50,[]);const[k,f]=l.useState([]),[h,w]=l.useState(1),[c,_]=l.useState([]),m=l.useMemo(()=>{const t=g?.slice();return w(1),p?t.filter(a=>a.name?.toLowerCase().includes(p.toLowerCase())):t},[g]),S=t=>{f(a=>a.map(e=>e?.id===+t?e.isCheck?(_(s=>s.filter(r=>r?.classId!==e?.id)),{isCheck:!1,id:e.id,students:e.students.map(s=>({...s,isCheck:!1,id:s.id})),class_number:e.class_number,color:e.color}):(_(s=>s.filter(r=>r?.classId===e?.id)[0]?[...s.filter(r=>r?.classId!==e.id),{classId:e?.id,students:e?.students?.map(r=>r?.id)}]:[...s,{classId:e?.id,students:e?.students?.map(r=>r?.id)}]),{isCheck:!0,id:e.id,students:e.students.map(s=>({...s,isCheck:!0,id:s.id})),class_number:e.class_number,color:e.color}):e))},j=(t,a)=>{_(e=>e.filter(s=>s?.classId===+a)[0]?e.map(s=>{if(s?.classId===a)return{classId:s?.classId,students:s?.students.includes(+t)?s.students.filter(r=>r!==+t):[...s.students,+t]}}):[...e,{classId:+a,students:[+t]}])};l.useEffect(()=>{f(t=>t.map(a=>{const e=c.filter(s=>s?.classId===a.id)[0];return e?{isCheck:e?.students?.length===a.students.length,id:a.id,students:a.students.map(s=>e?.students?.includes(s.id)?{...s,isCheck:!0,id:s.id}:{...s,isCheck:!1,id:s.id}),class_number:a.class_number,color:a.color}:a}))},[c,h]);const I=()=>{let t=[];c.map(s=>{s?.students?.map(r=>t.push(r))});const a=localStorage.getItem("flowData"),e={...JSON.parse(a),students:t,classes:[]};C(`${O}Flow/flow-list-create/`,"POST",JSON.stringify(e),T()).then(s=>{i(y({type:"success",msg:s.msg,status:!0})),localStorage.removeItem("flowData")}).then(()=>{x(-2)})},P=k?.map((t,a)=>n.jsx(R,{currentPage:h,flowList:t,onChangeAll:S,onChangeSingle:j,number:a},a));return n.jsxs("div",{className:o.flow,children:[n.jsx("div",{className:o.flowListHeader,children:n.jsxs("div",{children:[n.jsx("span",{children:"No"}),n.jsx("span",{children:"Sinf Raqami"})]})}),L?n.jsx(A,{}):n.jsxs("div",{className:o.table,children:[n.jsx("div",{children:P}),n.jsxs("div",{className:H(o.table__footer,{[o.active]:b<=m.length}),children:[n.jsx(J,{setCurrentTableData:f,users:m,currentPage:h,pageSize:b,onPageChange:t=>{w(t)}}),n.jsx(B,{extraClass:o.table__btn,onClick:I,type:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",disabled:c.filter(t=>t?.students?.length>0)[0]?"":"disabled",children:"Create"})]})]})]})};export{ls as FlowListPage};
