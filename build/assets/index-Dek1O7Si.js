import{b as ne,j as e,T as W,u as Y,a as o,r as s,aR as De,d as se,e as re,A as X,h as le,o as de,aS as Be,g as ce,B as Q,F as Z,D as M,I as G,aT as V,R as ke,C as Pe,E as oe,G as y,S as B,H as qe,aU as Ae,aV as ie,L as Le,aW as Te,aX as Re,aY as Ie,aZ as Oe,Y as $e,a_ as Ee,a3 as Me,a$ as Ge}from"./index-B8MDUGfS.js";import{C as Ve}from"./classAddForm-BgK2-NyK.js";import{a as Ye,b as He,c as ze,d as Ue,e as Je,f as Qe,h as We,i as Xe,N as Ze}from"./groupTimeTableForm-L7zg08JP.js";import{d as Ke}from"./groupProfileRating-CZvVA6xT.js";import{P as et}from"./pagination-ghXOUInD.js";import"./workerSelect-EUd4NawF.js";import"./teachers-BgoqnZZQ.js";import"./textArea-COR1f0Vl.js";import"./editableCard-27ppWT9K.js";import{C as tt}from"./confirmModal-BVnWUBfp.js";import{R as ue}from"./radio-CMbpfMTQ.js";import{g as st}from"./searchSelector-CJfw-E7m.js";import{u as at}from"./index.esm-CcfqcC2l.js";import{g as he,a as nt,b as rt,f as lt,h as dt}from"./oftenUsedSelector-DDKSaiMY.js";import{M as ct}from"./MultiPage-CSfzEECo.js";import"./groupsList--MsDYdKW.js";import"./userProfileSelector-DVds6RNm.js";import"./roomsSelectors-Dutms6Wd.js";import"./TransitionGroupContext-vPMg5md0.js";import"./TransitionGroup-Bm4nyiQN.js";import"./Transition-Cq79qX5v.js";import"./link-B6hWoGdj.js";import"./multiPageSlice-Bk8C9ZXU.js";import"./multiPageSelector-DhzQMvM1.js";const J={},ot=({currentTableData:i})=>{const l=ne(),u=()=>i?.map((a,j)=>e.jsxs("tr",{onClick:()=>l(`profile/${a?.id}`),children:[e.jsx("td",{children:j+1}),e.jsxs("td",{children:[a?.user?.name," ",a?.user?.surname]}),e.jsx("td",{children:a?.user?.age}),e.jsx("td",{children:a?.user?.phone}),e.jsx("td",{children:a?.group?.name?a.group.name:`${a?.class_number} ${a?.group?.color}`}),e.jsx("td",{children:e.jsx("div",{style:{width:"fit-content",border:a.color?`2px solid #${a.color}`:"2px solid black",color:`${a.color}`,padding:"1.5rem",borderRadius:"10px"},children:a.debt})})]},a.id));return e.jsx("div",{className:J.students,children:e.jsx("div",{className:J.table,children:e.jsxs(W,{extraClass:J.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nomer"}),e.jsx("th",{children:"Guruh nomi"}),e.jsx("th",{children:"Qarzi "})]})}),e.jsx("tbody",{children:u()})]})})})},it="_deletedStudents_9pq9e_1",ut="_deletedStudents__menu_9pq9e_11",ht="_active_9pq9e_25",D={deletedStudents:it,deletedStudents__menu:ut,active:ht},_t=({currentTableData:i})=>{const l=Y(),u=o(Ke),[a,j]=s.useState("all"),[m,S]=s.useState([]),[r,x]=s.useState([]),h=ne(),[C,_]=s.useState(!1),[N,w]=s.useState(!1);s.useEffect(()=>{l(De())},[]);const{request:F}=re(),c=()=>{F(`${X}Students/delete-student-from-deleted/${N}/`,"DELETE",null,le()).then(t=>{l(de({type:"success",status:!0,msg:t.msg}))}),_(!1),l(Be(N))},v=()=>i?.map((t,g)=>a==="all"?e.jsxs("tr",{children:[e.jsx("td",{children:g+1}),e.jsxs("td",{onClick:()=>h(`profile/${t?.student?.id}`),children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{w(t.student.id),_(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):t?.group_reason?.id===a?e.jsxs("tr",{onClick:()=>h(`profile/${t.id}`),children:[e.jsx("td",{children:g+1}),e.jsxs("td",{children:[t?.student?.name," ",t?.student?.surname]}),e.jsx("td",{children:t?.student?.age}),e.jsx("td",{children:t?.student?.phone}),e.jsx("td",{children:t?.group?.name}),e.jsx("td",{children:t?.student?.registered_date}),e.jsx("td",{children:t?.deleted_date}),e.jsx("td",{children:t?.group_reason?.name}),e.jsx("td",{children:e.jsx("div",{onClick:()=>{w(t.student.id),_(!0)},children:e.jsx("i",{className:"fa fa-times"})})})]}):null);return e.jsxs("div",{className:D.deletedStudents,children:[e.jsxs("ul",{className:D.deletedStudents__menu,children:[e.jsx("li",{className:se(D.other__item,{[D.active]:a==="all"}),onClick:()=>{j("all")},children:"Hammasi"},6),u?.map((t,g)=>e.jsx("li",{className:se(D.other__item,{[D.active]:a===t.id}),onClick:()=>{j(t.id)},children:t.name},g))]}),e.jsx("div",{className:D.table,children:e.jsxs(W,{extraClass:D.table__head,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Yosh"}),e.jsx("th",{children:"Telefon nome"}),e.jsx("th",{children:"Guruh"}),e.jsx("th",{children:"Reg.sana"}),e.jsx("th",{children:"O'chir.sana"}),e.jsx("th",{children:"Sabab"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:v()})]})}),e.jsx(tt,{onClick:c,title:"Qaytarish",text:"Studentni rostanham qaytarmoqchimisiz",type:"danger",active:C,setActive:_})]})},mt="_mainContainer_1qexw_1",xt="_mainContainer_buttonPanelBox_1qexw_4",gt="_mainContainer_filterPanelBox_1qexw_11",jt="_mainContainer_filterPanelBox_rightFilterRadioGroupBox_1qexw_15",St="_activeFilter_1qexw_22",k={mainContainer:mt,mainContainer_buttonPanelBox:xt,mainContainer_filterPanelBox:gt,mainContainer_filterPanelBox_rightFilterRadioGroupBox:jt,activeFilter:St},ft=({onChange:i,selectedRadio:l,peoples:u,setActive:a,onClick:j})=>{const m=o(ce);return e.jsxs("div",{className:k.mainContainer,children:[e.jsx("div",{className:k.mainContainer_buttonPanelBox}),e.jsxs("div",{className:k.mainContainer_filterPanelBox,children:[e.jsx(Q,{status:"filter",extraClass:k.extraCutClassFilter,onClick:()=>a("filter"),type:"filter",children:"Filter"}),e.jsx("a",{style:{color:"white"},href:`${X}Students/export-students/?branch=${m.id}&format=json`,children:e.jsx(Q,{type:"simple",children:"Exel formatda yuklash"})}),e.jsx("div",{className:k.mainContainer_filterPanelBox_rightFilterRadioGroupBox,children:u.map((S,r)=>e.jsx(ue,{onChange:()=>i(S.name),checked:l===S.name,extraClasses:l===S.name?k.activeFilter:null,children:S.label},r))})]})]})},pt="_createClass_s3igw_1",Ct="_createClass__input_s3igw_6",bt="_createClass__btn_s3igw_9",vt="_createClass__inner_s3igw_13",E={createClass:pt,createClass__input:Ct,createClass__btn:bt,createClass__inner:vt},yt=s.memo(i=>{const{active:l,setActive:u,data:a,branch:j,deactiveModal:m}=i,{request:S}=re(),r=Y(),x=o(Ye),h=o(He),[C,_]=s.useState([]);s.useEffect(()=>{_([])},[x]);const N=()=>{const c={...a,students:C};S(`${X}Group/groups/create/`,"POST",JSON.stringify(c),le()).then(v=>{r(de({type:"success",status:!0,msg:"Sinf yaratildi"})),r(V({userBranchId:j})),u(!1),m(!1)})},F=h==="loading"||h==="idle"?e.jsx(M,{}):x?.map((c,v)=>e.jsxs("tr",{children:[e.jsx("td",{children:v+1}),e.jsxs("td",{children:[c.user?.surname," ",c.user?.name]}),e.jsx("td",{children:c.user?.age}),e.jsx("td",{children:c.user?.language}),e.jsx("td",{children:c?.class_number}),e.jsx("td",{children:c.user?.registered_date}),e.jsx("td",{children:e.jsx(G,{extraClassName:E.createClass__input,type:"checkbox",onChange:()=>_(t=>t.filter(g=>g===c.id)[0]?t.filter(g=>g!==c.id):[...t,c.id])})})]}));return e.jsx(Z,{active:l,setActive:u,children:e.jsxs("div",{className:E.createClass,children:[e.jsx("h1",{children:"O'quvchi tanlang"}),e.jsx("div",{className:E.createClass__inner,children:e.jsxs(W,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"№"}),e.jsx("th",{children:"Full name"}),e.jsx("th",{children:"Age"}),e.jsx("th",{children:"Til"}),e.jsx("th",{children:"Sinf"}),e.jsx("th",{children:"Reg. sana"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:F})]})}),e.jsx(Q,{onClick:N,extraClass:E.createClass__btn,children:"Create"})]})})}),Nt=ke.memo(({active:i,setActive:l,activePage:u,setIsFilter:a,branchId:j})=>{const[m,S]=s.useState(""),[r,x]=s.useState(""),[h,C]=s.useState("all"),[_,N]=s.useState("all"),[w,F]=s.useState("all"),[c,v]=s.useState(!1),t=Y(),g=o(he),K=o(nt);function P(n,T,A,R){t(u==="studying_students"?ie({subjId:A,langId:R,fromAge:n,untilAge:T}):V({subjId:A,langId:R,fromAge:n,untilAge:T}))}const f=n=>{n!==h&&(C(n),P(m,r,n,_))},L=n=>{n!==_&&(N(n),P(m,r,h,n))},H=n=>{S(n.target.value),P(n.target.value,r,h,_)},z=n=>{x(n.target.value),P(m,n.target.value,h,_)},q=()=>{const n=!c;v(n),t(n?Ae(j):V({userBranchId:j}))};return s.useEffect(()=>{t(Pe()),t(oe())},[t]),e.jsx(Z,{active:i,setActive:l,children:e.jsxs("div",{className:y.filter,children:[e.jsx("h1",{children:"Filter"}),e.jsxs("div",{className:y.filter__container,children:[u!=="deleted"?e.jsx(B,{title:"Fan",options:[{name:"Hamma",id:"all"},...K],extraClass:y.filter__select,onChangeOption:n=>f(n),defaultValue:h}):null,u==="deleted"?e.jsx(B,{title:"Sinf",extraClass:y.filter__select,onChangeOption:F,defaultValue:w}):null,e.jsxs("div",{className:y.filter__age,children:[e.jsx(G,{type:"number",extraClassName:y.filter__input,placeholder:"Yosh (От)",onChange:n=>S(n.target.value),onBlur:H,defaultValue:m}),e.jsx(G,{type:"number",extraClassName:y.filter__input,placeholder:"Yosh (До)",onChange:n=>x(n.target.value),onBlur:z,defaultValue:r})]}),e.jsx(B,{title:"Til",options:[{name:"Hamma",id:"all"},...g],extraClass:y.filter__select,onChangeOption:n=>L(n),defaultValue:_}),e.jsxs("div",{className:y.filter__switch,children:[e.jsx("p",{children:"O’chirilgan"}),e.jsx(qe,{onChangeSwitch:q,activeSwitch:c})]})]})]})})}),wt=(i,l)=>{localStorage.setItem(i,l)},Ft=i=>localStorage.getItem(i),Dt="_tableMain_c2dxc_1",Bt="_modal_c2dxc_16",kt="_modal__error_c2dxc_21",Pt="_modal__form_c2dxc_26",qt="_modal__select_c2dxc_31",At="_modal__radios_c2dxc_34",Lt="_modal__inner_c2dxc_40",Tt="_modal__item_c2dxc_46",Rt="_modal__input_c2dxc_49",p={tableMain:Dt,modal:Bt,modal__error:kt,modal__form:Pt,modal__select:qt,modal__radios:At,modal__inner:Lt,modal__item:Tt,modal__input:Rt},ae=[{name:"new_students",label:"New Students"},{name:"studying_students",label:"Studying Students"},{name:"deleted_students",label:"Deleted Students"}],cs=()=>{const{theme:i}=Le(),l=Y(),[u]=Te(),{register:a,handleSubmit:j}=at(),m=JSON.parse(localStorage.getItem("selectedSystem")),{id:S}=o(ce),r=S,x=o(st),h=o(rt),C=o(lt),_=o(dt),N=o(he),w=o(ze),F=o(Ue),c=o(Je),v=o(Qe),t=o(We),g=o(Xe),[K,P]=s.useState(null),[f,L]=s.useState(Ft("selectedRadio")||ae[0].name),[H,z]=s.useState({}),[q,n]=s.useState(),[T,A]=s.useState(!1),[R,_e]=s.useState(),[ee,I]=s.useState(!1),[te,O]=s.useState(""),[me,xe]=s.useState(""),[$,ge]=s.useState([]),[je,U]=s.useState(1),[Se,fe]=s.useState(!0),pe=o(Re);let Ce=s.useMemo(()=>50,[]);const be=s.useMemo(()=>{let d=[];switch(f){case"new_students":d=F?.slice();break;case"studying_students":d=w?.slice();break;case"deleted_students":d=c?.slice();break;default:d=[]}return U(1),x?d.filter(b=>b.user?.name?.toLowerCase().includes(x.toLowerCase())||b.user?.surname?.toLowerCase().includes(x.toLowerCase())||b?.student?.user?.name.toLowerCase().includes(x.toLowerCase())||b?.student?.user?.surname.toLowerCase().includes(x.toLowerCase())):d},[F,w,c,x,f,me]);s.useEffect(()=>{r&&(l(Ie(r)),l(oe()))},[r]),s.useEffect(()=>{m?.name==="school"&&r&&(l(Oe()),l($e({branch:r})))},[m?.name,r]);const ve=d=>{if(!q&&C.length<=3)return A(!0),null;const b={...d,teacher:[+R],color:d?.color??q,branch:r,create_type:"school",system:m.id};z(b),O("post")},ye=d=>{fe(h.filter(b=>b.id===+d)[0]?.price===0||!h.filter(b=>b.id===+d)[0]?.price),l(Ge({branch:r,number:d}))};s.useEffect(()=>{if(r)switch(f){case"new_students":l(V({userBranchId:r}));break;case"studying_students":l(ie({userBranchId:r}));break;case"deleted_students":l(Ee({id:r}));break}},[l,f,r]),s.useEffect(()=>{const d=u.get("type");d&&L(d)},[u]),s.useEffect(()=>{wt("selectedRadio",f)},[f]);const Ne=d=>{L(d)},we=s.useCallback(()=>{switch(f){case"new_students":return v==="loading"?e.jsx(M,{}):e.jsx(Ze,{branchId:r,theme:i==="app_school_theme",currentTableData:$});case"deleted_students":return g==="loading"?e.jsx(M,{}):e.jsx(_t,{currentTableData:$});case"studying_students":return t==="loading"?e.jsx(M,{}):e.jsx(ot,{currentTableData:$});default:return null}},[v,g,t,f,$])(),Fe=s.useMemo(()=>[{name:"Yangi o'quvchilar",type:"new_students"},{name:"O'chirilgan o'quvchilar",type:"deleted_students"},{name:"O'qiyotgan o'quvchilar",type:"studying_students"}],[]);return e.jsxs(ct,{types:Fe,page:"students",children:[e.jsx(ft,{setActive:O,onChange:Ne,selectedRadio:f,peoples:ae,onClick:I}),e.jsx("div",{className:p.tableMain,children:we}),e.jsx(et,{setCurrentTableData:ge,users:be,setCurrentPage:U,currentPage:je,pageSize:Ce,onPageChange:d=>{U(d)},type:"custom"}),e.jsx(Nt,{active:te==="filter",setActive:O,activePage:f,setIsFilter:xe,branchId:r}),e.jsx(Z,{active:ee==="create",setActive:I,children:e.jsxs("div",{className:p.modal,children:[e.jsx("h1",{children:"Sinf yaratish"}),e.jsxs(Me,{onSubmit:j(ve),extraClassname:p.modal__form,typeSubmit:Se?"":"inside",children:[pe.name==="school"?null:e.jsx(G,{required:!0,extraClassName:p.modal__input,placeholder:"Sinf nomi",name:"name",register:a}),e.jsx(B,{required:!0,extraClass:p.modal__select,title:"O'qituvchi",options:_,onChangeOption:_e}),e.jsx(B,{required:!0,extraClass:p.modal__select,title:"Til",options:N,register:a,name:"language"}),e.jsx(B,{required:!0,extraClass:p.modal__select,title:"Sinf raqami",options:h,register:a,onChangeOption:ye,name:"class_number"}),T?e.jsx("span",{className:p.modal__error,children:"Sinfga rang tanlang"}):null,C.length<=3?e.jsx("div",{className:p.modal__radios,children:C?.map(d=>e.jsxs("div",{className:p.modal__inner,children:[e.jsx(ue,{extraClasses:p.modal__item,onChange:()=>{n(d.id),A(!1)},checked:q===d.id,name:"color"}),d.name]}))}):e.jsx(B,{required:!0,extraClass:p.modal__select,title:"Sinf rangi",name:"color",options:C,register:a})]})]})}),e.jsx(Ve,{branch:r,setActive:I,active:ee==="add"}),e.jsx(yt,{deactiveModal:I,setActive:O,active:te==="post",data:H,branch:r})]})};export{cs as StudentsPage};
