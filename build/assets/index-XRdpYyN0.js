import{r as n,a as x,b0 as re,j as e,T as R,c as B,e as L,A as v,h as W,g as $,u as V,I as E,aQ as oe,R as J,F as ie,S as ce,B as H,H as le}from"./index-CUkZIMn8.js";import"./pagination-BBALUyum.js";import{a as de,V as me,v as he}from"./vacancyPageEdit-DRrExafq.js";import{g as z}from"./userProfileSelector-DVds6RNm.js";import"./editableCard-oMSJDufg.js";import"./workerSelect-CgSdLQmn.js";import"./TransitionGroupContext-DM1NTbMR.js";import"./TransitionGroup-DtXXD_s0.js";import"./Transition-CrwhrZan.js";import"./index.esm-BRxczUgP.js";import"./vacancyPageAddThunk-CUnJi8Zh.js";const ue="_theadBody_3ewuw_21",_e="_workerList_3ewuw_41",xe="_workerSetting_3ewuw_48",ke="_userImage_3ewuw_52",T={theadBody:ue,workerList:_e,workerSetting:xe,userImage:ke},U="/assets/workerImg-CP2ssIh7.svg",F="data:image/svg+xml,%3csvg%20width='18'%20height='18'%20viewBox='0%200%2018%2018'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M6.70833%2017.3346L6.375%2014.668C6.19444%2014.5985%206.02431%2014.5152%205.86458%2014.418C5.70486%2014.3207%205.54861%2014.2166%205.39583%2014.1055L2.91667%2015.1471L0.625%2011.1888L2.77083%209.5638C2.75694%209.46658%202.75%209.37283%202.75%209.28255V8.72005C2.75%208.62977%202.75694%208.53602%202.77083%208.4388L0.625%206.8138L2.91667%202.85547L5.39583%203.89714C5.54861%203.78602%205.70833%203.68186%205.875%203.58464C6.04167%203.48741%206.20833%203.40408%206.375%203.33464L6.70833%200.667969H11.2917L11.625%203.33464C11.8056%203.40408%2011.9757%203.48741%2012.1354%203.58464C12.2951%203.68186%2012.4514%203.78602%2012.6042%203.89714L15.0833%202.85547L17.375%206.8138L15.2292%208.4388C15.2431%208.53602%2015.25%208.62977%2015.25%208.72005V9.28255C15.25%209.37283%2015.2361%209.46658%2015.2083%209.5638L17.3542%2011.1888L15.0625%2015.1471L12.6042%2014.1055C12.4514%2014.2166%2012.2917%2014.3207%2012.125%2014.418C11.9583%2014.5152%2011.7917%2014.5985%2011.625%2014.668L11.2917%2017.3346H6.70833ZM8.16667%2015.668H9.8125L10.1042%2013.4596C10.5347%2013.3485%2010.934%2013.1853%2011.3021%2012.9701C11.6701%2012.7548%2012.0069%2012.4944%2012.3125%2012.1888L14.375%2013.043L15.1875%2011.6263L13.3958%2010.2721C13.4653%2010.0777%2013.5139%209.87283%2013.5417%209.65755C13.5694%209.44228%2013.5833%209.22352%2013.5833%209.0013C13.5833%208.77908%2013.5694%208.56033%2013.5417%208.34505C13.5139%208.12978%2013.4653%207.92491%2013.3958%207.73047L15.1875%206.3763L14.375%204.95964L12.3125%205.83464C12.0069%205.51519%2011.6701%205.24783%2011.3021%205.03255C10.934%204.81727%2010.5347%204.65408%2010.1042%204.54297L9.83333%202.33464H8.1875L7.89583%204.54297C7.46528%204.65408%207.06597%204.81727%206.69792%205.03255C6.32986%205.24783%205.99306%205.50825%205.6875%205.8138L3.625%204.95964L2.8125%206.3763L4.60417%207.70964C4.53472%207.91797%204.48611%208.1263%204.45833%208.33464C4.43056%208.54297%204.41667%208.76519%204.41667%209.0013C4.41667%209.22352%204.43056%209.4388%204.45833%209.64714C4.48611%209.85547%204.53472%2010.0638%204.60417%2010.2721L2.8125%2011.6263L3.625%2013.043L5.6875%2012.168C5.99306%2012.4874%206.32986%2012.7548%206.69792%2012.9701C7.06597%2013.1853%207.46528%2013.3485%207.89583%2013.4596L8.16667%2015.668ZM9.04167%2011.918C9.84722%2011.918%2010.5347%2011.6332%2011.1042%2011.0638C11.6736%2010.4944%2011.9583%209.80686%2011.9583%209.0013C11.9583%208.19575%2011.6736%207.50825%2011.1042%206.9388C10.5347%206.36936%209.84722%206.08464%209.04167%206.08464C8.22222%206.08464%207.53125%206.36936%206.96875%206.9388C6.40625%207.50825%206.125%208.19575%206.125%209.0013C6.125%209.80686%206.40625%2010.4944%206.96875%2011.0638C7.53125%2011.6332%208.22222%2011.918%209.04167%2011.918Z'%20fill='%236B7280'/%3e%3c/svg%3e",Ce=({currentTableData:t,currentPage:o,PageSize:c,editMode:u,onEditClick:l})=>{const[k,d]=n.useState(!1),m=x(s=>s.vacancyWorkerSlice.workerData),j=Array.isArray(m)?m:[m],[f,_]=n.useState(null),p=`${re()}`,y=s=>{d(!0),_(s)},P=()=>j?.map((s,h)=>e.jsxs("tr",{children:[e.jsx("td",{children:(o-1)*c+h+1}),e.jsxs("td",{className:T.workerList,children:[s?.profile_img?e.jsx("img",{className:T.userImage,src:`${p}${s.profile_img}`,alt:""}):e.jsx("img",{src:U,alt:""}),`${s?.name} - ${s?.surname}`," ",e.jsx("img",{className:T.workerSetting,onClick:()=>y(s?.id),src:F,alt:""})]})]},s?.id));return e.jsx(e.Fragment,{children:e.jsxs(R,{children:[e.jsx("thead",{className:T.theadBody,children:e.jsxs("tr",{children:[e.jsx("th",{children:"â„–"}),e.jsx("th",{children:"Worker"})]})}),e.jsx("tbody",{children:P()}),f&&e.jsx(de,{user_id:f,active:k,setActive:d})]})})},fe=[{id:1,workName:"Kimdir",workerNames:"Nima yozishni bilmadim"},{id:2,workName:"O'quvchi",workerNames:"Nima yozishni bilmadim"},{id:3,workName:"Manager",workerNames:"Nima yozishni bilmadim"},{id:4,workName:"Admin",workerNames:"Nima yozishni bilmadim"},{id:5,workName:"Qo'shni",workerNames:"Nima yozishni bilmadim"},{id:6,workName:"Sattor aka",workerNames:"Nima yozishni bilmadim"},{id:7,workName:"Ko'chani boshidagi brat",workerNames:"Nima yozishni bilmadim"}],ge=[{workerImg:U,workerName:"Mahmud Yuldoshov",workerSetting:F}],be="_deletedGroups_16ogk_1",pe="_mainContainer_filterPanelBox_16ogk_1",je="_mainContainer_buttonPanelBox_16ogk_35",we="_mainContainer_buttonPanelBox_leftCreateButton_16ogk_42",ye="_mainContainer_buttonPanelBox_leftCreateButtons_16ogk_50",Pe="_mainContainer_tablePanelBox_16ogk_86",Se="_buttonHelper_16ogk_101",Ne="_buttonHelpers_16ogk_110",b={deletedGroups:be,mainContainer_filterPanelBox:pe,mainContainer_buttonPanelBox:je,mainContainer_buttonPanelBox_leftCreateButton:we,mainContainer_buttonPanelBox_leftCreateButtons:ye,mainContainer_tablePanelBox:Pe,buttonHelper:Se,buttonHelpers:Ne},Be="_theadBody_adwtd_1",Le="_checkBox_adwtd_15",q={theadBody:Be,checkBox:Le},Z=B("vacancyWorkPageSlice/fetchWorkerWithId",async t=>{const{request:o}=L();return await o(`${v}Permissions/job_profile/${t}`,"GET",null,W())}),M=t=>t.vacancyWorkPageSlice?.workerPermission,ve=t=>t.vacancyWorkPageSlice?.loading,We=({currentTableData:t,currentPage:o,PageSize:c,editMode:u,onEditClick:l,selectedItems:k,setSelectedItems:d})=>{const{id:m}=x($),j=V(),f=x(M);f.job?.map(s=>s.group.name);const _=x(ve);n.useEffect(()=>{m&&j(Z(m))},[j,m]);const p=s=>{s.target.checked?d(t.map(h=>h.id)):d([])},y=(s,h)=>{s.target.checked?d(g=>[...g,h]):d(g=>g.filter(a=>a!==h))},P=()=>_?e.jsx(oe,{}):f.job?.map((s,h)=>{const g=s.group.permissions||[];return e.jsx(J.Fragment,{children:g.map((a,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:(o-1)*c+r+1}),e.jsx("td",{children:s.group.name}),e.jsx("td",{children:a.name}),!u&&e.jsx("td",{children:e.jsx(E,{style:{width:"25px"},type:"checkbox",checked:k.includes(s.id),onChange:i=>y(i,s.id)})})]},a.id))},s.id)});return e.jsxs(R,{children:[e.jsx("thead",{className:q.theadBody,children:e.jsxs("tr",{children:[e.jsx("th",{children:"â„–"}),e.jsx("th",{children:"Ishchi ismi"}),e.jsx("th",{children:"Ruxsatlari"}),!u&&e.jsx("th",{className:q.checkBox,children:e.jsx(E,{style:{width:"25px"},type:"checkbox",onChange:p,checked:k.length===t.length})})]})}),e.jsx("tbody",{children:P()})]})},Ie="_filter_1xl0c_1",De="_filter__container_1xl0c_7",Te="_filter__select_1xl0c_13",He="_workerPermission_1xl0c_51",Ae="_buttonHome_1xl0c_62",N={filter:Ie,filter__container:De,filter__select:Te,workerPermission:He,buttonHome:Ae},Ee=t=>t.vacancyWorkerPermissionSlice?.tables,$e=B("vacancyWorkerPermissionSlice/fetchPermissionTable",async()=>{const{request:t}=L();return await t(`${v}Permissions/tables/`,"GET",null,W())}),A=B("vacancyWorkerPermissionSlice/postSelectedTable",async(t,{rejectWithValue:o})=>{const{request:c}=L();try{return await c(`${v}Permissions/tables/`,"POST",JSON.stringify({table:t}),W())}catch(u){return o(u.message)}});B("vacancyWorkerPermissionSlice/postSelectedTable",async t=>{const{request:o}=L();return await o(`${v}Permissions/job_profile/${t}`,"POST",JSON.stringify({permissions:{id:t}}),W())});const G=B("vacancyWorkerPermissionSlice/postSelectedPermission",async({id:t,selectedTable:o,selectedPermissions:c,selectedJobID:u})=>{const{request:l}=L();return await l(`${v}Permissions/job_profile/${t}`,"POST",JSON.stringify({job_id:u,permissions:c}),W())}),Ve=J.memo(({active:t,setActive:o,onAddVacancy:c})=>{const[u,l]=n.useState(""),[k,d]=n.useState([]),[m,j]=n.useState([]),f=x(M),_=V(),{id:p}=x($),y=x(Ee),P=f.job?.length?Number(f.job[0].id):null;n.useEffect(()=>{_($e())},[_]);const s=a=>{l(a),_(A(a)).then(r=>{A.fulfilled.match(r)?j(r.payload.permissions):console.error("Permissionlada xato",r.payload)})},h=(a,r)=>{a.target.checked?d(i=>[...i,r]):d(i=>i.filter(S=>S!==r))},g=()=>{const a={id:Date.now(),workName:u,workerNames:k.join(", ")};c(a),d([]),l(""),_(A(a));const r=m.permissions.filter(i=>k.includes(i.name)).map(i=>i.id);p&&_(G({id:p,selectedJobID:P,selectedPermissions:r})).then(i=>{if(G.fulfilled.match(i)){_(Z(p));const S={id:Date.now(),permissions:r};c(S),d([]),l(""),o(!1)}else console.error("Xatolik yuz berdi",i.payload)})};return e.jsx(ie,{active:t,setActive:o,children:e.jsxs("div",{className:N.filter,children:[e.jsx("h1",{children:"Add"}),e.jsxs("div",{className:N.filter__container,children:[e.jsx(ce,{title:"Ish turi",extraClass:N.filter__select,onChangeOption:s,options:y.tables,required:!0,value:u}),m.permissions?.map(a=>e.jsxs("div",{className:N.workerPermission,children:[e.jsx("h4",{children:a.name}),e.jsx(E,{style:{width:"20px",marginTop:"15px"},type:"checkbox",checked:k.includes(a.name),onChange:r=>h(r,a.name)})]},a.id))]}),e.jsx("div",{className:N.buttonHome,children:e.jsx(H,{children:"Add",onClick:g})})]})})}),Qe=()=>{const[t,o]=n.useState(!1),[c,u]=n.useState(!1),[l,k]=n.useState(!1),[d,m]=n.useState(!1),[j,f]=n.useState(!1),[_,p]=n.useState(1),[y,P]=n.useState(""),[s,h]=n.useState([]),[g,a]=n.useState(null),[r,i]=n.useState([]),[S,K]=n.useState(!1),Q=V();x(M);const O=n.useMemo(()=>20,[]),X=x(z),{id:Y}=x($),I=x(z);n.useEffect(()=>{I&&I?.job&&K(I.job.includes("director"))},[I]),n.useEffect(()=>{h(l?ge:fe)},[l]);const ee=C=>{a(C),m(!0)},se=C=>{h(w=>w.map(D=>D.id===C.id?C:D)),m(!1)},te=()=>{h(C=>C.filter(w=>!r.includes(w.id))),i([])},ne=async C=>{k(!l);const w={job:Number(C)};try{await Q(he(w))}catch(D){console.error("An error occurred:",D)}},ae=C=>{h(w=>[...w,C])};return e.jsxs("div",{className:b.deletedGroups,children:[e.jsx("div",{className:b.mainContainer_filterPanelBox}),e.jsxs("div",{className:b.mainContainer_buttonPanelBox,children:[e.jsx("div",{className:b.mainContainer_buttonPanelBox_leftCreateButtons,children:S?e.jsx(le,{activeSwitch:l,onChangeSwitch:()=>ne(Y)}):null}),e.jsxs("div",{className:b.mainContainer_buttonPanelBox_leftCreateButton,children:[l?null:e.jsxs(e.Fragment,{children:[e.jsx(H,{extraClass:b.buttonHelper,children:e.jsx("i",{className:"fas fa-plus"}),onClick:()=>o(!t)}),e.jsx(H,{extraClass:b.buttonHelper,children:e.jsx("i",{className:"fas fa-pencil"}),onClick:()=>u(!c)})]}),!c&&r.length>0&&e.jsx(H,{extraClass:b.buttonHelpers,children:e.jsx("i",{style:{color:"white"},className:"fas fa-trash"}),onClick:te})]})]}),e.jsx("div",{className:b.mainContainer_tablePanelBox,children:l?e.jsx(Ce,{currentTableData:X,currentPage:_,PageSize:O}):e.jsx(We,{currentTableData:s,currentPage:_,PageSize:O,editMode:c,onEditClick:ee,selectedItems:r,setSelectedItems:i})}),e.jsx(me,{setModal:m,modal:d,vacancy:g,onSave:se}),e.jsx(Ve,{setActive:o,active:t,onAddVacancy:ae})]})};export{Qe as VacancyWorkPage};
