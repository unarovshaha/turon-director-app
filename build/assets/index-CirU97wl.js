import{b as $,r as l,u as E,j as e,B as S,T as R,D as V,F as D,I as T,a3 as B,S as L,a as _,g as z,O as U,e as G,A as J,h as K,ak as Q}from"./index-CTtC1zcc.js";import"./groupProfileRating-DI2nse-h.js";import{g as W}from"./groupTimeTableForm-DPQyfYJ9.js";import{P as X}from"./pagination-Dn5WTQBc.js";import{g as Y}from"./searchSelector-CJfw-E7m.js";import"./workerSelect-CXz8TkGO.js";import{a as Z}from"./teachers-BWBVUtcH.js";import{T as ee}from"./textArea-xhti2b3I.js";import"./editableCard-DRKBnIvM.js";import{b as se,a as q,F as te}from"./flowFilter-ZAiF7tmg.js";import{u as O}from"./index.esm-X1Z8qUg7.js";import{a as H,g as ae,b as le,k as oe,i as re,d as de,l as ne}from"./flowsProfileThunk-DEvsth7T.js";import{b as ce}from"./userProfileSelector-DVds6RNm.js";import{M as ie}from"./MultiPage-BHljwvgh.js";import"./confirmModal-DQuz2eI0.js";import"./groupsList-BPOA2aMN.js";import"./roomsSelectors-Dutms6Wd.js";import"./oftenUsedSelector-DDKSaiMY.js";import"./TransitionGroupContext-DbAT11Dm.js";import"./TransitionGroup-B2vHOldA.js";import"./Transition-C-_OCrFs.js";import"./link-BQL38z-k.js";import"./multiPageSlice-Dy_bQnk9.js";import"./multiPageSelector-5hEFgVZ3.js";const ue="_flow_t6vt0_1",fe="_flowMain_t6vt0_7",_e="_flowMain__wrapper_t6vt0_12",he="_flow__header_t6vt0_15",me="_flow__filter_t6vt0_23",xe="_modal_t6vt0_57",pe="_flowModal_t6vt0_61",we="_flowModalHeader_t6vt0_64",je="_flowModalForm_t6vt0_69",f={flow:ue,flowMain:fe,flowMain__wrapper:_e,flow__header:he,flow__filter:me,modal:xe,flowModal:pe,flowModalHeader:we,flowModalForm:je},Fe=({currentTableData:I,teacherData:C,loading:N,levelData:h,getLevelData:j,setActive:F,branchId:b})=>{const i=$(),{register:r,handleSubmit:p,setValue:y}=O(),[n,g]=l.useState(!1),[A,v]=l.useState(!1),[m,k]=l.useState(!1),[u,P]=l.useState([]);E();const[d,w]=l.useState(!1),x=t=>{const s={...t,activity:d,branch:b};localStorage.setItem("flowData",JSON.stringify(s)),i("flow-list")};l.useEffect(()=>{u&&y("subject",u[0]?.id)},[u]);const o=()=>I?.map((t,s)=>e.jsxs("tr",{onClick:()=>i(`./flowsProfile/${t?.id}`),children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:t?.name}),e.jsxs("td",{children:[t?.subject_name,t?.level_name?` / ${t?.level_name}`:null]}),e.jsx("td",{children:t?.student_count}),e.jsxs("td",{children:[t?.teacher_name,t?.teacher_surname]})]}));return e.jsxs("div",{className:f.flowMain,children:[e.jsxs("div",{className:f.flow__filter,children:[e.jsx(S,{onClick:()=>k(!m),type:"simple-add",children:"Filter"}),e.jsxs("div",{className:f.flowMain__wrapper,children:[e.jsx(S,{onClick:()=>g(!n),type:"simple",children:"Create Flow"}),e.jsx(S,{type:"simple-add",onClick:()=>F(!0),children:"Add Flow"})]})]}),e.jsxs(R,{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nomi"}),e.jsx("th",{children:"Fan Level"}),e.jsx("th",{children:"O'quvchi soni"}),e.jsx("th",{children:"O'qituvchisi"})]})}),N==="loading"?e.jsx(V,{}):e.jsx("tbody",{children:o()})]}),e.jsxs(D,{active:n,setActive:g,extraClass:f.modal,children:[e.jsx("h2",{children:"Create Flow"}),e.jsxs("div",{className:f.flowModal,children:[e.jsxs("div",{className:f.flowModalHeader,children:[e.jsx("h3",{children:"Activity"}),e.jsx(T,{onChange:()=>w(!d),type:"checkbox"})]}),e.jsx("div",{className:f.flowModalForm,children:e.jsxs(B,{typeSubmit:"",onSubmit:p(x),action:"",children:[e.jsx(T,{placeholder:"Nomi",register:r,name:"name",required:!0}),d?null:e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"O'qituvchini tanlang",options:C,onChangeOption:t=>{t&&j(t),P(C.filter(s=>s.id===+t)[0]?.subject)},register:r,name:"teacher"}),u?.length?e.jsx(L,{title:"Fan",options:u,register:r,name:"subject",defaultValue:u[0]?.id}):null,h?.length?e.jsx(L,{title:"Level",options:h,register:r,name:"level"}):null,e.jsx(ee,{placeholder:"Koment",register:r,name:"comment"})]}),e.jsx(S,{children:"Next"})]})})]})]}),e.jsxs(D,{active:A,setActive:v,children:[e.jsx("h2",{children:"Add Flow"}),e.jsx("div",{className:f.flowModalForm,children:e.jsxs(B,{typeSubmit:"",children:[e.jsx(L,{}),e.jsx(S,{type:"simple",children:"Add"})]})})]}),e.jsx(se,{active:m,setActive:k})]})},be="_addForm_1tbfl_1",ge="_addForm__btn_1tbfl_7",ve="_addModal_1tbfl_12",Me="_addModal__header_1tbfl_21",Se="_addModal__inner_1tbfl_31",Ce="_addModal__container_1tbfl_37",Ae="_addModal__btn_1tbfl_95",M={addForm:be,addForm__btn:ge,addModal:ve,addModal__header:Me,addModal__inner:Se,addModal__container:Ce,addModal__btn:Ae},ke=l.memo(I=>{const{active:C,setActive:N}=I,h=E(),{register:j,handleSubmit:F}=O(),b=_(H),i=_(ae),r=_(ce),p=_(le),[y,n]=l.useState([]),[g,A]=l.useState(!1),[v,m]=l.useState([]);l.useEffect(()=>{h(q(r))},[]),l.useEffect(()=>{p&&n(p)},[p]),l.useEffect(()=>{r&&i&&h(oe({flow:i?.id,branch:r,res:{ignore_students:i?.students.map(o=>o?.id)}}))},[r,i]);const k=o=>{h(re({id:o?.flow})),A(!0)},u=()=>{let o=[];v.map(s=>{s?.students?.map(a=>o.push(a))});const t={update_type:"add_students",students:o};h(de({id:i?.id,res:t}))},P=o=>{n(t=>t.map(s=>s.id===+o?s.isCheck?(m(a=>a.filter(c=>c.classId!==s.id)),{isCheck:!1,id:s.id,students:s.students.map(a=>({isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):(m(a=>a.filter(c=>c.classId===s.id)[0]?[...a.filter(c=>c.classId!==s.id),{classId:s.id,students:s?.students?.map(c=>c?.id)}]:[...a,{classId:s.id,students:s?.students?.map(c=>c?.id)}]),{isCheck:!0,id:s.id,students:s.students.map(a=>({isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user})),class_number:s.class_number,color:s.color}):s))},d=(o,t)=>{m(s=>s.filter(a=>a?.classId===+t)[0]?s.map(a=>{if(a?.classId===t)return{classId:a.classId,students:a.students.includes(+o)?a.students.filter(c=>c!==+o):[...a.students,+o]}}):[...s,{classId:+t,students:[+o]}])};l.useEffect(()=>{n(o=>o.map(t=>{const s=v.filter(a=>a?.classId===t.id)[0];return s?{isCheck:s?.students?.length===t.students.length,id:t.id,students:t.students.map(a=>s?.students?.includes(a.id)?{isCheck:!0,id:a.id,extra_info:a.extra_info,user:a.user}:{isCheck:!1,id:a.id,extra_info:a.extra_info,user:a.user}),class_number:t.class_number,color:t.color}:t}))},[v]);const x=y.map((o,t)=>e.jsx(te,{flowList:o,onChangeAll:P,onChangeSingle:d,number:t},t));return e.jsxs(e.Fragment,{children:[e.jsx(D,{active:C,setActive:N,children:e.jsxs(B,{extraClassname:M.addForm,onSubmit:F(k),typeSubmit:"",children:[e.jsx("h2",{children:"Add Flow"}),e.jsx(L,{options:b,register:j,title:"Patok",name:"flow"}),e.jsx(S,{extraClass:M.addForm__btn,children:"Tekshirmoq"})]})}),e.jsxs(D,{active:g,setActive:A,extraClass:M.addModal,children:[e.jsx("div",{className:M.addModal__header,children:e.jsxs("div",{className:M.addModal__inner,children:[e.jsx("span",{children:"No"}),e.jsx("span",{children:"Sinf Raqami"})]})}),e.jsx("div",{className:M.addModal__container,children:x}),e.jsx(S,{extraClass:M.addModal__btn,onClick:u,children:"Add"})]})]})}),Ze=()=>{let I=l.useMemo(()=>50,[]);const[C,N]=l.useState([]),[h,j]=l.useState(1),F=_(Y),b=localStorage.getItem("selectedBranch"),{request:i}=G(),r=E(),p=_(H),y=_(ne),n=_(z),g=_(Z),A=_(W),[v,m]=l.useState(!1),k=l.useMemo(()=>{const d=p?.filter(w=>!w.deleted)||[];return j(1),F?d.filter(w=>w?.name?.toLowerCase().includes(F.toLowerCase())):d},[p,F]);l.useEffect(()=>{r(q(n?.id))},[n]),l.useEffect(()=>{b&&r(U({userBranchId:b}))},[b]);const u=d=>{const w=g.filter(x=>x.id===+d)[0]?.subject[0]?.id;i(`${J}Subjects/level-for-subject/${w}/`,"GET",null,K()).then(x=>{r(Q(x))}).catch(x=>console.log(x))},P=l.useMemo(()=>[{name:"Flows",type:"flows"}],[]);return e.jsx(ie,{types:P,page:"students",children:e.jsxs("div",{className:f.flow,children:[e.jsx("div",{className:f.flow__header}),e.jsx(Fe,{branchId:n?.id,currentTableData:C,loading:y,teacherData:g,levelData:A,getLevelData:u,setActive:m}),e.jsx(X,{setCurrentTableData:N,users:k,setCurrentPage:j,currentPage:h,pageSize:I,onPageChange:d=>{j(d)},type:"custom"}),e.jsx(ke,{userBranchId:n.id,active:v,setActive:m})]})})};export{Ze as FlowsPage};
