import{u as E,r as c,j as n,al as J,D as M,e as w,A as $,h as q,am as Y,o as K,a as k,an as B,ao as U,ap as W,aq as z}from"./index-CUkZIMn8.js";import{ar as ue}from"./index-CUkZIMn8.js";import{u as G}from"./index.esm-BRxczUgP.js";import{C as Q}from"./confirmModal-2O0sEs7y.js";const X="_calendarList_1mi5e_1",Z={calendarList:X},ee=i=>{const{setActive:u,currentData:D,loading:b,data:I,onSubmit:L,isChanged:C,setIsChanged:a}=i,{request:g}=w(),S=E(),[y,x]=c.useState([]),[A,f]=c.useState(!1),[j,s]=c.useState(null),p=()=>{g(`${$}Calendar/delete-type/`,"DELETE",JSON.stringify({days:j}),q()).then(e=>{S(Y(e)),S(K({type:"success",status:!0,msg:`${e.length>1?"Kunlar":"Kun"} o'chirildi`})),f(!1)}).catch(e=>console.log(e))},m=e=>{s(e),f(!0)};c.useEffect(()=>{C?(x([]),a(!1)):y.length&&u(e=>({...e,days:y}))},[C,y]);const N=(e,t,h,r,o)=>{let l=h.map((d,V)=>{if(d.startId&&!d?.finishId){const _=d.startId<e?d.startId:e,P=d.startId<e?e:d.startId;return u(H=>({...H,finishValue:t,startId:_,finishId:P})),{startId:_,finishId:P}}else return!d?.startId&&h[V-1]?.finishId!==e?{startId:e}:d});const v=l[l.length-1].startId&&l[l.length-1].finishId?[...l,{}]:l;r(v),o([])};function O(e,t){let h=[...e].sort(T),r=0,o=[],l=[];const v=h.length+t<=35?35:42;for(;r<v;)r<t?o.push(""):r-t<h.length?o.push({id:h[r-t],value:h[r-t]}):o.push(""),o.length===7&&(l.push(o),o=[]),r=r+1;return l}function T(e,t){return e.id-t.id}const F=c.useCallback(()=>I&&[...I].map((e,t)=>n.jsx(J,{month:t,setActive:u,data:e.months,onActiveDays:N,sortWeeksDays:O,currentData:D.id===t?D:{},setSelected:x,onSubmit:L,isChanged:C,setIsChanged:a,onSubmitDelete:m},t)),[D,I]),R=b?n.jsx(M,{}):F();return n.jsxs(n.Fragment,{children:[n.jsx("div",{className:Z.calendarList,children:R}),n.jsx(Q,{type:"danger",active:A,setActive:f,onClick:p})]})},te=i=>i.calendarSlice.data,se=i=>i.calendarSlice.loading,ae="_calendarPage_1oety_1",ne={calendarPage:ae},oe=()=>{const{request:i}=w(),u=E(),{register:D,handleSubmit:b,setValue:I}=G(),L=k(te),C=k(se),[a,g]=c.useState({}),[S,y]=c.useState({}),[x,A]=c.useState(!1),f=new Date().getFullYear(),j=s=>{let p;y({...s,...a,color:s?.color??"black"}),a?.length?p={...s,days:a,color:s?.color??"black"}:a?.selected?.length?p={...s,days:a?.selected,color:s?.color??"black"}:p={...s,...a,color:s?.color??"black"},i(`${$}Calendar/change-type/`,"POST",JSON.stringify(p),q()).then(m=>{u(z(m)),u(K({type:"success",status:!0,msg:`${m.length>1?"Kunlar":"Kun"} qo'shildi`}))}).catch(m=>console.log(m)),g({}),A(!0)};return c.useEffect(()=>{u(B({current_year:f,next_year:f+1}))},[]),n.jsxs("div",{className:ne.calendarPage,children:[n.jsx(U,{}),n.jsx(ee,{setActive:g,currentData:S,loading:C,data:L,onSubmit:g,onDelete:s=>s([{}]),isChanged:x,setIsChanged:A}),n.jsx(W,{active:a?.finishValue||a?.length,setActive:g,onSubmit:b(j),register:D,setValue:I,success:S})]})};export{oe as CalendarPage,ue as calendarReducer};
